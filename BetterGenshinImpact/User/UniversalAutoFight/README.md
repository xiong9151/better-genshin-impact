# 万能自动战斗角色出招表说明

## 文件夹状态说明

- **处于待完成目录下的所有角色**是因为本人未持有，需要等待其他人完善。修改后请将对应文件夹移入万能战斗目录下。

## 角色目录文件规范

每个角色目录下至多存在以下几类文件：
- 出招表文件若干个（格式：出招表_*.txt）
- 待完成文件
- 待精调文件  
- 已完成文件
- Readme文件

### 文件状态含义

- **如果出招表只存在已完成与Readme文件**：说明该角色基本上已经处理好了。
- **如果存在待精调文件**：说明该角色可能需要进一步精细调整，但已经属于可以使用的状态。
- **如果存在待完成文件**：说明该角色基本处于不可用的状态，需要其他人完善出招表。

## 出招表编写原则

下面是一些个人推荐：

1. **所有没有任何特殊效果的普通攻击**都处于优先级10
2. **生存角色的主要生存技能**优先级在1到3
3. **生存角色的被动/切人释放技能**：如果这个生存角色有一些不需要主动释放，但是可以在切出来的时候顺手释放的技能，请将它的优先级设置为2到4
4. **持续性的后台输出技能**的优先级请设置为3到5
5. **增益类的技能**优先级设置为4到6
6. **战场型角色的主要输出技能**优先级设置为5到7
7. **非战场型角色的特殊普通攻击**设置为8到9（例如琴，七七，心海）

## 重要说明

- **出招表的优先级并不代表最终出招的优先级**，它只是参与最终出招计算。
- **一般而言出招表优先级越小的技能会越早被释放**。
- **最大持续时间设置为0时，系统会使用实际执行时间进行CD计算和优先级更新**

## 出招表格式说明

### 第一行：CD配置
```
<最大持续时间> <技能名>:<CD时间>:<接受的CD时间>[;<技能名>:<CD时间>:<接受的CD时间>]*
```

- **最大持续时间**：整个出招序列的最大执行时间（秒）
  - 如果设置为0，系统会使用指令的实际执行时间进行后续处理
  - 如果大于0，系统会确保总执行时间不超过此值，并在指令执行不足时自动添加wait补齐
- **技能CD时间**：执行当前出招表之后，对应技能会被禁用的时间长度
  - 注意：这个CD并非是角色技能的真实CD，它只代表着执行这个出招表之后这个技能会被禁用多少时间
  - 例如：如果出招表中的E技能是在出招表的第5秒才执行，那么上方的E技能CD应该设置为角色的E技能真实CD加5秒钟
- **接受的CD时间**：如果对应的技能CD小于接受的CD时间时，该优先级不会被固定为11；只有当对应技能的真实CD大于接受的CD时间时，该出招表的优先级才会被固定为11
  - 接受的CD时间这一项可以省略，若省略则默认为零
  - 例如上面的例子，应该设置接受E技能CD为5秒

### 第二行：优先级设置
- 静态优先级：直接输入数字（如：10）
- 动态优先级：时间1-时间2-优先级a-优先级b-优先级c

### 第三行及以后：执行指令
- 对应出招表需要执行哪些指令
- 具体格式与一键宏或者原本的自动战斗相同
- 不需要输入角色名称

## 战斗执行流程

万能自动战斗系统的选择出招表流程如下：

1. **技能冷却检查**：检查出招表涉及的技能是否在冷却中
   - 如果技能的实际剩余CD > 接受的CD时间，则该出招表优先级固定为11（最低优先级）
   
2. **基础优先级计算**：
   - 根据出招表第二行的优先级设置计算基础优先级
   - 动态优先级会根据累计执行时间进行线性插值
   
3. **优先级调整**：
   - 当前前台角色：优先级减1
   - 队伍中护盾排列最靠前的角色：优先级减1  
   - 队伍中治疗排列最靠前的角色：优先级减1
   
4. **最终选择**：
   - 选择优先级最小的出招表执行
   - 如果多个出招表优先级相同：
     - 优先选择护盾角色
     - 其次选择治疗角色  
     - 然后按前台排列顺序选择
     - 最后按出招表名称字母顺序选择

5. **执行后处理**：
   - **时间控制**：
     - 如果最大持续时间 > 0：执行指令时会严格限制在指定时间内，超时部分会被截断；如果指令执行时间不足，会自动添加wait指令补齐
     - 如果最大持续时间 = 0：执行所有指令，使用实际执行时间进行后续处理
   - 更新技能CD（使用第一行配置的CD时间）
   - 更新出招表累计执行时间（使用实际执行时间或预设时间）
   - 切换到对应角色（如果需要）
   - 执行指令序列
   - 输出执行日志（显示预设时间和实际指令执行时间）